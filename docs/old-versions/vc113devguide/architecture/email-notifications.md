---
title: Email notifications
description: Email notifications
layout: docs
date: 2015-03-18T20:11:12.560Z
priority: 3
---
## Introduction

This guide details how to leverage the notification/template engine to have eCommerce automatically send out email notifications for new orders, cases, and more.В  The notification/template engine is used to generate different types of templated content and is mostly used to generate personalized emails for customers regarding orders.

The template engine itself is very customizable and can be completely replaced by injecting custom implementation of ITemplateService.

The default implementation we provide supports XSL, (in future will support also HTML and Text) templates that are configured using eCommerce manager (administration tool). It allows creating templates using <a href="http://msdn.microsoft.com/en-us/library/aa926341.aspx" rel="nofollow">XML Stylesheet Language (XSL)</a>. This provides a very powerful and flexible way of creating notification templates for different outgoing emails.

The emails can be sent using regular Smtp implementation if not hosted on windows azure, or using <a href="http://sendgrid.com/" rel="nofollow">SendGrid</a> implemented for azure platform.

## Key Classes and Files

**TemplateService.cs**В - Loads the appropriate template, formats it based on template settings and returns formatted text for email. To create custom Implementation of TemplateService just implement ITemplateService and inject instead of default TemplateService:

```
using System.Collections.Generic;
using System.Globalization;
В 
namespace VirtoCommerce.Foundation.Frameworks.Templates
{
  public interface ITemplateService
  {
    IProcessedTemplate ProcessTemplate(string templateName, IDictionary<string, object> context, CultureInfo culture);
  }
}
```

**ProcessedTemplate.cs**В - Returned by TemplateService. Contains processed body for email, Subject for email and type of template that was generated by service (xsl,html or text)

```
using VirtoCommerce.Foundation.AppConfig.Model;
namespace VirtoCommerce.Foundation.Frameworks.Templates
{
  public interface IProcessedTemplate
  {
    /// <summary>
    /// The processed body of template for sending email
    /// </summary>
    string Body { get; set; }
    /// <summary>
    /// Template subject
    /// </summary>
    string Subject { get; set; }
    /// <summary>
    /// The type of processed template
    /// </summary>
    EmailTemplateTypes Type { get; set; }
  }
}
```

**NetEmailService.cs** andВ **AzureEmailService.cs** - Implementation for sending email messages. To add custom implementation of EmailService implement IEmailService interface:

```
namespace VirtoCommerce.Foundation.Frameworks.Email
{
  public interface IEmailService
  {
    bool SendEmail(IEmailMessage message);
  }
}
```

**EmailMessage.cs**В - passed as parameter for EmailService:

```
using System.Collections.Generic;
В 
namespace VirtoCommerce.Foundation.Frameworks.Email
{
  public interface IEmailMessage
  {
    /// <summary>
    /// List of email recipient addresses
    /// </summary>
    List<string> To { get; }
    /// <summary>
    /// Address from where the email is sent
    /// </summary>
    string From { get; set; }
    /// <summary>
    /// Html body of emai message
    /// </summary>
    string Html { get; set; }
    /// <summary>
    /// Text body of email message
    /// </summary>
    string Text { get; set; }
    /// <summary>
    /// The subject of the email message
    /// </summary>
    string Subject { get; set; }
    /// <summary>
    /// Additional attachemts that can be sent by email
    /// </summary>
    List<byte[]> Attachments { get; }
  }
}
```

## Quick Overview

In the web.config file of your public sites, look to this section:

```
<system.net>
  <mailSettings>
    <smtp from="email@company.com">
      <network host="localhost" port="25" />
    </smtp>
  </mailSettings>
В </system.net>
```

You can add username and password in there as well if your SMTP server requires authentication. The from address is optional, but will be used in EmailService implementation if no From address is passed in IEmailMessage.

DefaultEmailFrom should be configured in Commerce Manager Settings tab.

For more information about configuring the mail settings, see <a href="http://msdn.microsoft.com/en-us/library/w355a94k.aspx" rel="nofollow">http://msdn.microsoft.com/en-us/library/w355a94k.aspx</a>.

For more information on SendGrid (AzureEmailService) see <a href="http://sendgrid.com/docs" rel="nofollow">sendgrid.com/docs</a>

## How it works

Relevent data, including the Order object are placed in a dictionary and passed to the TemplateService.ProcessTemplate() method with the name of the template, and a CultureInfo instance representing the desired/current culture. The Process() method returns the formatted custom text. Context data can contain any number and any type objects. The important thing is that template and passed object could be processed.

To create new email template first you need to open commerce manager and go to settings/email templates

<img src="../../../assets/images/EmailTemplates.jpg" />

* Display name used to identify template, which is loaded in when sending specific email
* Type Xsl to use xslt as Body for template
* Default language code identifies default language when specific template in Languages for this template is not found
* Subject is used when sending email

## Code Example for Sending Out Emails

The following code is taken from theВ OrderChangeEventListener.cs that is registered as event throughВ EntityEventInterceptor and raised after new Order entity is added.

```
private void SendNewOrderNotificationsAsync(Order order)
{
  // the whole function should be async
  Task.Run(() =>
  {
    //Create a context object
    IDictionary<string, object> context = new Dictionary<string, object>();
    context.Add("order", order);

    //Send order-confirmation email
    var confirmTempate = _templateService.ProcessTemplate("order-confirmation", context, new CultureInfo("en-us"));

    var recipientAddress = order.OrderAddresses.FirstOrDefault(oa => oa.OrderAddressId == order.AddressId);
    if (recipientAddress != null)
    {
      SendEmail(confirmTempate, recipientAddress.Email);
    }

    //Send order-notification email
    var notifyTemplate = _templateService.ProcessTemplate("order-notify", context, new CultureInfo("en-us"));

    if (_storeService != null)
    {
      var store = _storeService.Stores.FirstOrDefault(s => s.StoreId == order.StoreId);

      if (store != null)
      {
        SendEmail(notifyTemplate, store.Email);
      }
    }
  });
}
В 
private bool SendEmail(IProcessedTemplate template, string recipient)
{
  if (string.IsNullOrEmpty(recipient) || template == null || string.IsNullOrEmpty(template.Body))
  {
    return false;
  }
  var isHtml = template.Type != EmailTemplateTypes.Text;
  IEmailMessage message = new EmailMessage(recipient, template.Body, isHtml);
  message.Subject = template.Subject;
  message.From = "orders@virtoway.com";
  try
  {
    _emailService.SendEmail(message);
  }
  catch
  {
    //Log
    return false;
  }

  return true;
}
```

## XSL/XML processing Template Service

Template service renders templates using a XSL content saved in database EmailTemplates table. It expects that all the parameters passed in the dictionary context can be serialized to xml. It then looks for the specific template by template name. If it can't find language specificВ template in EmailTemplateLanguage it will use the default template.

For example when Order is passed to the template service the following XML is generated:

```
<?xml version="1.0"?>
<ContextDoc>
В В <Order xmlns:i="http://www.w3.org/2001/XMLSchema-instance" z:Id="i1" xmlns:z="http://schemas.microsoft.com/2003/10/Serialization/">
В В В В <Created>2013-05-14T12:04:34.1027676Z</Created>
В В В В <Errors xmlns:d2p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays" />
В В В В <LastModified>2013-05-14T12:04:34.1027676Z</LastModified>
В В В В <AddressId>e80bf493-c2cf-4cd3-8794-91e3dc49f400</AddressId>
В В В В <BillingCurrency>USD</BillingCurrency>
В В В В <CustomerId>1</CustomerId>
В В В В <CustomerName>John Doe</CustomerName>
В В В В <HandlingTotal>0</HandlingTotal>
В В В В <Name>Order_For_John Doe</Name>
В В В В <OrderAddresses>
В В В В В В <OrderAddress z:Id="i2">
В В В В В В В В <Created>2013-05-14T12:04:34.1027676Z</Created>
В В В В В В В В <Errors xmlns:d4p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays" />
В В В В В В В В <LastModified>2013-05-14T12:04:34.1027676Z</LastModified>
В В В В В В В В <City>Los Angeles</City>
В В В В В В В В <CountryCode>US</CountryCode>
В В В В В В В В <CountryName>United States</CountryName>
В В В В В В В В <DaytimePhoneNumber>none</DaytimePhoneNumber>
В В В В В В В В <Email>john_doe_work@gmail.com</Email>
В В В В В В В В <EveningPhoneNumber i:nil="true" />
В В В В В В В В <FaxNumber i:nil="true" />
В В В В В В В В <FirstName>John</FirstName>
В В В В В В В В <LastName>Doe</LastName>
В В В В В В В В <Line1>8237 Santa Monica Blvd</Line1>
В В В В В В В В <Line2 i:nil="true" />
В В В В В В В В <Name>Shipping</Name>
В В В В В В В В <OrderAddressId>75d5ae03-7a4d-4fc5-85c9-991a6548290f</OrderAddressId>
В В В В В В В В <OrderGroup z:Ref="i1" />
В В В В В В В В <OrderGroupId>816dd41c-d393-4ed4-925e-4269dcd47c93</OrderGroupId>
В В В В В В В В <Organization i:nil="true" />
В В В В В В В В <PostalCode>90210</PostalCode>
В В В В В В В В <RegionId i:nil="true" />
В В В В В В В В <RegionName i:nil="true" />
В В В В В В В В <StateProvince i:nil="true" />
В В В В В В </OrderAddress>
В В В В В В <OrderAddress z:Id="i3">
В В В В В В В В <Created>2013-05-14T12:04:34.1027676Z</Created>
В В В В В В В В <Errors xmlns:d4p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays" />
В В В В В В В В <LastModified>2013-05-14T12:04:34.1027676Z</LastModified>
В В В В В В В В <City>Los Angeles</City>
В В В В В В В В <CountryCode>US</CountryCode>
В В В В В В В В <CountryName>United States</CountryName>
В В В В В В В В <DaytimePhoneNumber>none</DaytimePhoneNumber>
В В В В В В В В <Email>john_doe_work@gmail.com</Email>
В В В В В В В В <EveningPhoneNumber i:nil="true" />
В В В В В В В В <FaxNumber i:nil="true" />
В В В В В В В В <FirstName>John</FirstName>
В В В В В В В В <LastName>Doe</LastName>
В В В В В В В В <Line1>8237 Santa Monica Blvd</Line1>
В В В В В В В В <Line2 i:nil="true" />
В В В В В В В В <Name>Billing</Name>
В В В В В В В В <OrderAddressId>e80bf493-c2cf-4cd3-8794-91e3dc49f400</OrderAddressId>
В В В В В В В В <OrderGroup z:Ref="i1" />
В В В В В В В В <OrderGroupId>816dd41c-d393-4ed4-925e-4269dcd47c93</OrderGroupId>
В В В В В В В В <Organization i:nil="true" />
В В В В В В В В <PostalCode>90210</PostalCode>
В В В В В В В В <RegionId i:nil="true" />
В В В В В В В В <RegionName i:nil="true" />
В В В В В В В В <StateProvince i:nil="true" />
В В В В В В </OrderAddress>
В В В В </OrderAddresses>
В В В В <OrderForms>
В В В В В В <OrderForm z:Id="i4">
В В В В В В В В <Created>2013-05-14T12:04:34.1027676Z</Created>
В В В В В В В В <Errors xmlns:d4p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays" />
В В В В В В В В <LastModified>2013-05-14T12:04:34.1027676Z</LastModified>
В В В В В В В В <BillingAddressId>e80bf493-c2cf-4cd3-8794-91e3dc49f400</BillingAddressId>
В В В В В В В В <DiscountAmount>0</DiscountAmount>
В В В В В В В В <Discounts />
В В В В В В В В <HandlingTotal>0</HandlingTotal>
В В В В В В В В <LineItems>
В В В В В В В В В В <LineItem z:Id="i5">
В В В В В В В В В В В В <Created>2013-05-14T12:04:34.1027676Z</Created>
В В В В В В В В В В В В <Errors xmlns:d6p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays" />
В В В В В В В В В В В В <LastModified>2013-05-14T12:04:34.1027676Z</LastModified>
В В В В В В В В В В В В <AllowBackordersAndPreorders>false</AllowBackordersAndPreorders>
В В В В В В В В В В В В <BackorderQuantity>0</BackorderQuantity>
В В В В В В В В В В В В <Catalog>VendorVirtual</Catalog>
В В В В В В В В В В В В <CatalogCategory i:nil="true" />
В В В В В В В В В В В В <CatalogItemCode>v-b004nzb8tu</CatalogItemCode>
В В В В В В В В В В В В <CatalogItemId>v-b004nzb8tu</CatalogItemId>
В В В В В В В В В В В В <CatalogOutline i:nil="true" />
В В В В В В В В В В В В <Comment i:nil="true" />
В В В В В В В В В В В В <Description i:nil="true" />
В В В В В В В В В В В В <Discounts />
В В В В В В В В В В В В <DisplayName>Samsung LN26D450 26-Inch 720p 60Hz LCD HDTV (Black)</DisplayName>
В В В В В В В В В В В В <ExtendedPrice>349.9900</ExtendedPrice>
В В В В В В В В В В В В <FulfillmentCenterId i:nil="true" />
В В В В В В В В В В В В <InStockQuantity>0</InStockQuantity>
В В В В В В В В В В В В <InventoryStatus i:nil="true" />
В В В В В В В В В В В В <LineItemDiscountAmount>0</LineItemDiscountAmount>
В В В В В В В В В В В В <LineItemId>5f715fb5-f774-4a82-95a1-d819b3602006</LineItemId>
В В В В В В В В В В В В <ListPrice>349.99</ListPrice>
В В В В В В В В В В В В <MaxQuantity>10.00</MaxQuantity>
В В В В В В В В В В В В <MinQuantity>1.00</MinQuantity>
В В В В В В В В В В В В <Options />
В В В В В В В В В В В В <OrderForm z:Ref="i4" />
В В В В В В В В В В В В <OrderFormId>21b9f8f6-c56c-4303-ba2e-e649a90ce269</OrderFormId>
В В В В В В В В В В В В <ParentCatalogItemId />
В В В В В В В В В В В В <PlacedPrice>349.99</PlacedPrice>
В В В В В В В В В В В В <PreorderQuantity>0</PreorderQuantity>
В В В В В В В В В В В В <Quantity>1.00</Quantity>
В В В В В В В В В В В В <ShippingAddressId>75d5ae03-7a4d-4fc5-85c9-991a6548290f</ShippingAddressId>
В В В В В В В В В В В В <ShippingMethodId>FreeShipping</ShippingMethodId>
В В В В В В В В В В В В <ShippingMethodName>Free Shipping</ShippingMethodName>
В В В В В В В В В В В В <Status i:nil="true" />
В В В В В В В В В В </LineItem>
В В В В В В В В В В <LineItem z:Id="i6">
В В В В В В В В В В В В <Created>2013-05-14T12:04:34.1027676Z</Created>
В В В В В В В В В В В В <Errors xmlns:d6p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays" />
В В В В В В В В В В В В <LastModified>2013-05-14T12:04:34.1027676Z</LastModified>
В В В В В В В В В В В В <AllowBackordersAndPreorders>false</AllowBackordersAndPreorders>
В В В В В В В В В В В В <BackorderQuantity>0</BackorderQuantity>
В В В В В В В В В В В В <Catalog>Apple</Catalog>
В В В В В В В В В В В В <CatalogCategory i:nil="true" />
В В В В В В В В В В В В <CatalogItemCode>5b24ada9-3</CatalogItemCode>
В В В В В В В В В В В В <CatalogItemId>04c7f90f-ae47-4ad9-b256-edbb96a6b793</CatalogItemId>
В В В В В В В В В В В В <CatalogOutline />
В В В В В В В В В В В В <Comment i:nil="true" />
В В В В В В В В В В В В <Description i:nil="true" />
В В В В В В В В В В В В <Discounts>
В В В В В В В В В В В В В В <LineItemDiscount z:Id="i7">
В В В В В В В В В В В В В В В В <Created>2013-05-14T12:04:34.1027676Z</Created>
В В В В В В В В В В В В В В В В <Errors xmlns:d8p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays" />
В В В В В В В В В В В В В В В В <LastModified>2013-05-14T12:04:34.1027676Z</LastModified>
В В В В В В В В В В В В В В В В <DiscountAmount>10.00</DiscountAmount>
В В В В В В В В В В В В В В В В <DiscountCode i:nil="true" />
В В В В В В В В В В В В В В В В <DiscountId>5917bccb-b202-4616-8378-408fce6a6d50</DiscountId>
В В В В В В В В В В В В В В В В <DiscountName>$10 Gift Card</DiscountName>
В В В В В В В В В В В В В В В В <DisplayMessage>$10 Gift card for orders over $100</DisplayMessage>
В В В В В В В В В В В В В В В В <PromotionId>a9804bdf-dbc2-4b46-af06-6145fc085d8c</PromotionId>
В В В В В В В В В В В В В В В В <LineItem z:Ref="i6" />
В В В В В В В В В В В В В В В В <LineItemId>8b0fddb9-e82a-42aa-941d-358e9fb18c94</LineItemId>
В В В В В В В В В В В В В В </LineItemDiscount>
В В В В В В В В В В В В </Discounts>
В В В В В В В В В В В В <DisplayName>$10 Gift card</DisplayName>
В В В В В В В В В В В В <ExtendedPrice>0</ExtendedPrice>
В В В В В В В В В В В В <FulfillmentCenterId i:nil="true" />
В В В В В В В В В В В В <InStockQuantity>0</InStockQuantity>
В В В В В В В В В В В В <InventoryStatus i:nil="true" />
В В В В В В В В В В В В <LineItemDiscountAmount>10.00</LineItemDiscountAmount>
В В В В В В В В В В В В <LineItemId>8b0fddb9-e82a-42aa-941d-358e9fb18c94</LineItemId>
В В В В В В В В В В В В <ListPrice>10.00</ListPrice>
В В В В В В В В В В В В <MaxQuantity>0</MaxQuantity>
В В В В В В В В В В В В <MinQuantity>1.00</MinQuantity>
В В В В В В В В В В В В <Options />
В В В В В В В В В В В В <OrderForm z:Ref="i4" />
В В В В В В В В В В В В <OrderFormId>21b9f8f6-c56c-4303-ba2e-e649a90ce269</OrderFormId>
В В В В В В В В В В В В <ParentCatalogItemId i:nil="true" />
В В В В В В В В В В В В <PlacedPrice>10.00</PlacedPrice>
В В В В В В В В В В В В <PreorderQuantity>0</PreorderQuantity>
В В В В В В В В В В В В <Quantity>1.00</Quantity>
В В В В В В В В В В В В <ShippingAddressId>75d5ae03-7a4d-4fc5-85c9-991a6548290f</ShippingAddressId>
В В В В В В В В В В В В <ShippingMethodId>FreeShipping</ShippingMethodId>
В В В В В В В В В В В В <ShippingMethodName>Free Shipping</ShippingMethodName>
В В В В В В В В В В В В <Status i:nil="true" />
В В В В В В В В В В </LineItem>
В В В В В В В В </LineItems>
В В В В В В В В <Name>OrderForm_For_John Doe</Name>
В В В В В В В В <OrderFormId>21b9f8f6-c56c-4303-ba2e-e649a90ce269</OrderFormId>
В В В В В В В В <OrderGroup z:Ref="i1" />
В В В В В В В В <OrderGroupId>816dd41c-d393-4ed4-925e-4269dcd47c93</OrderGroupId>
В В В В В В В В <Payments>
В В В В В В В В В В <Payment z:Id="i8" xmlns:d5p1="http://schemas.datacontract.org/2004/07/VirtoCommerce.Foundation.Orders.Model" i:type="d5p1:OtherPayment">
В В В В В В В В В В В В <Created>2013-05-14T12:04:34.1027676Z</Created>
В В В В В В В В В В В В <Errors xmlns:d6p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays" />
В В В В В В В В В В В В <LastModified>2013-05-14T12:04:34.1027676Z</LastModified>
В В В В В В В В В В В В <Amount>0</Amount>
В В В В В В В В В В В В <AuthorizationCode i:nil="true" />
В В В В В В В В В В В В <BillingAddressId>e80bf493-c2cf-4cd3-8794-91e3dc49f400</BillingAddressId>
В В В В В В В В В В В В <ContractId i:nil="true" />
В В В В В В В В В В В В <OrderForm z:Ref="i4" />
В В В В В В В В В В В В <OrderFormId>21b9f8f6-c56c-4303-ba2e-e649a90ce269</OrderFormId>
В В В В В В В В В В В В <PaymentId>2c778a59-64db-42a7-9579-c8bba425a7c4</PaymentId>
В В В В В В В В В В В В <PaymentMethodId>Phone</PaymentMethodId>
В В В В В В В В В В В В <PaymentMethodName>Phone</PaymentMethodName>
В В В В В В В В В В В В <PaymentType>0</PaymentType>
В В В В В В В В В В В В <PaymentTypeId>0</PaymentTypeId>
В В В В В В В В В В В В <Status>Processing</Status>
В В В В В В В В В В В В <TransactionType i:nil="true" />
В В В В В В В В В В В В <ValidationCode i:nil="true" />
В В В В В В В В В В </Payment>
В В В В В В В В </Payments>
В В В В В В В В <Shipments>
В В В В В В В В В В <Shipment z:Id="i9">
В В В В В В В В В В В В <Created>2013-05-14T12:04:34.1027676Z</Created>
В В В В В В В В В В В В <Errors xmlns:d6p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays" />
В В В В В В В В В В В В <LastModified>2013-05-14T12:04:34.1027676Z</LastModified>
В В В В В В В В В В В В <Discounts />
В В В В В В В В В В В В <FulfillmentCenterId i:nil="true" />
В В В В В В В В В В В В <ItemSubtotal>0</ItemSubtotal>
В В В В В В В В В В В В <ItemTaxTotal>0</ItemTaxTotal>
В В В В В В В В В В В В <OrderForm z:Ref="i4" />
В В В В В В В В В В В В <OrderFormId>21b9f8f6-c56c-4303-ba2e-e649a90ce269</OrderFormId>
В В В В В В В В В В В В <Picklist xmlns:d6p1="http://schemas.datacontract.org/2004/07/VirtoCommerce.Foundation.Orders.Model.Fulfillment" i:nil="true" />
В В В В В В В В В В В В <PicklistId i:nil="true" />
В В В В В В В В В В В В <ShipmentId>b24cbecd-3fb5-4886-8ef3-578c93aa9cce</ShipmentId>
В В В В В В В В В В В В <ShipmentItems>
В В В В В В В В В В В В В В <ShipmentItem z:Id="i10">
В В В В В В В В В В В В В В В В <Created>2013-05-14T12:04:34.1027676Z</Created>
В В В В В В В В В В В В В В В В <Errors xmlns:d8p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays" />
В В В В В В В В В В В В В В В В <LastModified>2013-05-14T12:04:34.1027676Z</LastModified>
В В В В В В В В В В В В В В В В <LineItem z:Ref="i5" />
В В В В В В В В В В В В В В В В <LineItemId>5f715fb5-f774-4a82-95a1-d819b3602006</LineItemId>
В В В В В В В В В В В В В В В В <Quantity>1.00</Quantity>
В В В В В В В В В В В В В В В В <Shipment z:Ref="i9" />
В В В В В В В В В В В В В В В В <ShipmentId>b24cbecd-3fb5-4886-8ef3-578c93aa9cce</ShipmentId>
В В В В В В В В В В В В В В В В <ShipmentItemId>75ab3aae-9605-44bc-a0ac-96c82ddbe703</ShipmentItemId>
В В В В В В В В В В В В В В </ShipmentItem>
В В В В В В В В В В В В </ShipmentItems>
В В В В В В В В В В В В <ShipmentTotal>0</ShipmentTotal>
В В В В В В В В В В В В <ShipmentTrackingNumber i:nil="true" />
В В В В В В В В В В В В <ShippingAddressId>75d5ae03-7a4d-4fc5-85c9-991a6548290f</ShippingAddressId>
В В В В В В В В В В В В <ShippingDiscountAmount>0</ShippingDiscountAmount>
В В В В В В В В В В В В <ShippingMethodId>FreeShipping</ShippingMethodId>
В В В В В В В В В В В В <ShippingMethodName>Free Shipping</ShippingMethodName>
В В В В В В В В В В В В <ShippingTaxTotal>0</ShippingTaxTotal>
В В В В В В В В В В В В <Status>AwaitingInventory</Status>
В В В В В В В В В В В В <Subtotal>0</Subtotal>
В В В В В В В В В В В В <TotalBeforeTax>0</TotalBeforeTax>
В В В В В В В В В В </Shipment>
В В В В В В В В </Shipments>
В В В В В В В В <ShippingTotal>0</ShippingTotal>
В В В В В В В В <Status i:nil="true" />
В В В В В В В В <Subtotal>359.9900</Subtotal>
В В В В В В В В <TaxTotal>0</TaxTotal>
В В В В В В В В <Total>349.9900</Total>
В В В В В В </OrderForm>
В В В В </OrderForms>
В В В В <OrderGroupId>816dd41c-d393-4ed4-925e-4269dcd47c93</OrderGroupId>
В В В В <OrganizationId i:nil="true" />
В В В В <ShippingTotal>0</ShippingTotal>
В В В В <Status>Pending</Status>
В В В В <StoreId>SampleStore</StoreId>
В В В В <Subtotal>359.9900</Subtotal>
В В В В <TaxTotal>0</TaxTotal>
В В В В <Total>349.9900</Total>
В В В В <ExpirationDate i:nil="true" />
В В В В <RmaRequests />
В В В В <TrackingNumber>Order-2013.05.14-00000</TrackingNumber>
В В </Order>
</ContextDoc>
```

It is then processed by the template similar to this:

```
<?xml version="1.0" encoding="utf-8"?>
<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform" xmlns:ms="urn:schemas-microsoft-com:xslt">
В В <xsl:output method="html" />
В В <xsl:template match="/">
В В В В <html>
В В В В В В <head id="Head1">
В В В В В В В В <style type="text/css">
В В В В В В В В В В #PurchaseOrder {}
В В В В В В В В В В h1 {font-size: 20px;}
В В В В В В В В В В h2 {font-size: 18px;}
В В В В В В В В В В h3 {font-size: 16px; background-color: #cccccc; padding: 2px 2px 2px 2px}
В В В В В В В В В В .introduction {padding: 5px 0 0 0}
В В В В В В В В В В .footer {padding: 5px 0 0 0}
В В В В В В В В </style>
В В В В В В В В <title>
В В В В В В В В В В Order Notification
В В В В В В В В </title>
В В В В В В </head>
В В В В В В <body>
В В В В В В В В <xsl:apply-templates select="//Order"></xsl:apply-templates>
В В В В В В </body>
В В В В </html>
В В </xsl:template>
В В <xsl:template match="Order">
В В В В <div id="PurchaseOrder">
В В В В В В <h1>Sale/Order Notification from the Store</h1>
В В В В В В <h1>**ORDER SUMMARY</h1>
В В В В В В <xsl:call-template name="OrderHeader"></xsl:call-template>
В В В В В В <div class="OrderForms">
В В В В В В В В <h2>Products Purchased:</h2>
В В В В В В В В <xsl:apply-templates select="OrderForms/OrderForm"></xsl:apply-templates>
В В В В В В </div>
В В В В В В <xsl:call-template name="OrderFooter"></xsl:call-template>
В В В В В В <div class="Footer">
В В В В В В В В Regards,<br/> your Company.
В В В В В В </div>
В В В В </div>
В В </xsl:template>
В В <xsl:template name="PaymentPlanSchedule">
В В В В <div class="schedule">
В В В В В В Payment Schedule: starting&#160;<xsl:value-of select="ms:format-date(StartDate, 'MMM dd, yyyy')"/>&#160;every&#160;<xsl:value-of select="CycleLength"/>&#160;<xsl:call-template name="PlanCycle" />&#160;for&#160;<xsl:value-of select="MaxCyclesCount"/>&#160;<xsl:call-template name="PlanCycle" />&#160;till&#160;<xsl:value-of select="ms:format-date(EndDate, 'MMM dd, yyyy')"/>
В В В В </div>
В В </xsl:template>
В В <xsl:template name="PlanCycle">
В В В В <xsl:value-of select="CycleMode"/>(s)
В В </xsl:template>
В В <xsl:template name="OrderHeader">
В В В В Order Number: <xsl:value-of select="TrackingNumber"/><br/>
В В В В Status: <xsl:value-of select="Status"/><br/>
В В В В Name: <xsl:value-of select="CustomerName"/><br/>
В В В В Email: <a>
В В В В В В <xsl:attribute name="href">
В В В В В В В В mailto:<xsl:value-of select="//OrderAddresses/OrderAddress[OrderAddressId=//AddressId]/Email"/>
В В В В В В </xsl:attribute>
В В В В В В <xsl:value-of select="//OrderAddresses/OrderAddress[OrderAddressId=//AddressId]/Email"/>
В В В В </a>
В В </xsl:template>
В В <xsl:template name="OrderFooter">
В В В В <h3>Order Summary</h3>
В В В В <div class="OrderSummary">
В В В В В В Sub Total: <xsl:value-of select="BillingCurrency"/>&#160;<xsl:value-of select="format-number(Subtotal, '###,##0.00')"/><br/>
В В В В В В Handling Total: <xsl:value-of select="BillingCurrency"/>&#160;<xsl:value-of select="format-number(HandlingTotal, '###,##0.00')"/><br/>
В В В В В В Shipping Total: <xsl:value-of select="BillingCurrency"/>&#160;<xsl:value-of select="format-number(ShippingTotal, '###,##0.00')"/><br/>
В В В В В В Total Tax: <xsl:value-of select="BillingCurrency"/>&#160;<xsl:value-of select="format-number(TaxTotal, '###,##0.00')"/><br/>
В В В В В В TOTAL: <xsl:value-of select="BillingCurrency"/>&#160;<xsl:value-of select="format-number(Total, '###,##0.00')"/><br/>
В В В В </div>
В В </xsl:template>
В В <xsl:template match="OrderForm">
В В В В <div class="OrderForm">
В В В В В В <div class="OrderForms">
В В В В В В В В <h3>Line Items</h3>
В В В В В В В В <xsl:apply-templates select="LineItems/LineItem"></xsl:apply-templates>
В В В В В В В В <h3>Payments</h3>
В В В В В В В В <xsl:apply-templates select="Payments/Payment"></xsl:apply-templates>
В В В В В В </div>
В В В В В В <div class="OrderSummary">
В В В В В В </div>
В В В В </div>
В В </xsl:template>
В В <xsl:template match="LineItem">
В В В В <div class="LineItem">
В В В В В В <xsl:value-of select="format-number(Quantity, '###,###.##')"/>&#160;<xsl:value-of select="DisplayName"/> - <xsl:value-of select="//BillingCurrency"/>&#160;<xsl:value-of select="format-number(ListPrice, '###,###.00')"/> each
В В В В </div>
В В </xsl:template>
В В <xsl:template match="Payment">
В В В В <div class="Payment">
В В В В В В Payment Method: <xsl:value-of select="PaymentMethodName"/><br/>
В В В В В В Amount: <xsl:value-of select="//BillingCurrency"/>&#160;<xsl:value-of select="format-number(Amount, '###,##0.00')"/>
В В В В </div>
В В </xsl:template>
</xsl:stylesheet>
```

The resulting output would be:

```
<html xmlns:ms="urn:schemas-microsoft-com:xslt">
В В <head id="Head1">
В В В В <META http-equiv="Content-Type" content="text/html; charset=utf-8">
В В В В <style type="text/css">
В В В В В В В В В В В В В В В В В В В В #PurchaseOrder {}
В В В В В В В В В В В В В В В В В В В В h1 {font-size: 20px;}
В В В В В В В В В В В В В В В В В В В В h2 {font-size: 18px;}
В В В В В В В В В В В В В В В В В В В В h3 {font-size: 16px; background-color: #cccccc; padding: 2px 2px 2px 2px}
В В В В В В В В В В В В В В В В В В В В .introduction {padding: 5px 0 0 0}
В В В В В В В В В В В В В В В В В В В В .footer {padding: 5px 0 0 0}
В В В В В В В В В В В В В В В В </style>
В В В В <title>
В В В В В В В В В В В В В В В В В В В В Order Notification
В В В В В В В В В В В В В В В В </title>
В В </head>
В В <body>
В В В В <div id="PurchaseOrder">
В В В В В В <h1>Sale/Order Notification from the Store</h1>
В В В В В В <h1>**ORDER SUMMARY</h1>
В В В В В В В В Order Number: Order-2013.05.14-00000<br>
В В В В В В В В Status: Pending<br>
В В В В В В В В Name: John Doe<br>
В В В В В В В В Email: <a href="mailto:john_doe_work@gmail.com">john_doe_work@gmail.com</a><div class="OrderForms">
В В В В В В В В <h2>Products Purchased:</h2>
В В В В В В В В <div class="OrderForm">
В В В В В В В В В В <div class="OrderForms">
В В В В В В В В В В В В <h3>Line Items</h3>
В В В В В В В В В В В В <div class="LineItem">1 Samsung LN26D450 26-Inch 720p 60Hz LCD HDTV (Black) - USD 349.99 each
В В В В В В В В </div>
В В В В В В В В В В В В <div class="LineItem">1 $10 Gift card - USD 10.00 each
В В В В В В В В </div>
В В В В В В В В В В В В <h3>Payments</h3>
В В В В В В В В В В В В <div class="Payment">
В В В В В В В В В В В В Payment Method: Phone<br>
В В В В В В В В В В В В Amount: USD 0.00</div>
В В В В В В В В В В </div>
В В В В В В В В В В <div class="OrderSummary"></div>
В В В В В В В В </div>
В В В В В В </div>
В В В В В В <h3>Order Summary</h3>
В В В В В В <div class="OrderSummary">
В В В В В В В В В В В В Sub Total: USD 359.99<br>
В В В В В В В В В В В В Handling Total: USD 0.00<br>
В В В В В В В В В В В В Shipping Total: USD 0.00<br>
В В В В В В В В В В В В Total Tax: USD 0.00<br>
В В В В В В В В В В В В TOTAL: USD 349.99<br></div>
В В В В В В <div class="Footer">
В В В В В В В В В В В В В В В В Regards,<br> your Company.
В В В В В В В В В В В В </div>
В В В В </div>
В В </body>
</html>
```

## Namespaces

* **VirtoCommerce.Foundation.Frameworks.Templates**В - Contains interfaces for template service
* **VirtoCommerce.Web.Client.Services.Templates** - Contains implementation of template service
* **VirtoCommerce.Foundation.Frameworks.Email** -В Contains interfaces for email service
* **VirtoCommerce.Web.Client.Services.Emails** - Contains implementation of email service
